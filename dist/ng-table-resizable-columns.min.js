/*! ngTableColumnResizable v0.1.0 by Vitalii Savchuk(esvit666@gmail.com) - https://github.com/esvit/ng-table-resizable-columns - New BSD License */

angular.module("ngTableResizableColumns",[]).factory("ngTableResizableColumnsHelper",function(){function a(a,b,c){var d=function(a,b){return function(){return a.apply(b,arguments)}};if(this.saveRestoreService=null,c.saveRestoreService){var f=c.saveRestoreService.split(":"),g=f[0],h=f[1],i=angular.element(document).injector(g);this.saveRestoreService=i.get(h)}else window.store&&(this.saveRestoreService=angular.injector().get("ngTableResizableColumnsSaveRestoreStoreService"));this.pointerdown=d(this.pointerdown,this);var j=this;this.options={customReloadEvent:c.customReloadEvent,scopeReloadEvent:c.customReloadEvent||e,rigidSizing:!1,resizeFromBody:!!c.resizeFromBody},this.$table=a,this.state=0,this.unwatchOn=null;var k=b.$watch("params",function(a,b){if(!a.isNullInstance){if(2==j.state)return;j.setHeaders(),j.restoreColumnWidths(),j.syncHandleWidths(!0),j.state=1,j.options.customReloadEvent||$(window).on("resize.rc",function(){return j.syncHandleWidths(!0)}),j.unwatchOn=j.$table.scope().$on(j.options.scopeReloadEvent,function(a){j.syncHandleWidths(!0)}),k()}})}var b=function(a){return parseFloat(a.style.width.replace("%",""))},c=function(a,b){return a.style.width=""+b.toFixed(3)+"%"},d=function(a){return 0===a.type.indexOf("touch")?(a.originalEvent.touches[0]||a.originalEvent.changedTouches[0]).pageX:a.pageX},e="ng-table-resizable-columns-update";return a.prototype.getColumnId=function(a){return this.$table.data("resizable-columns-id")+"-"+a.data("resizable-column-id")},a.prototype.setHeaders=function(){return this.$tableHeaders=this.$table.find("thead tr:first th:visible"),this.assignPercentageWidths(),this.createHandles()},a.prototype.destroy=function(){return 1==this.state&&this.$handleContainer&&this.$handleContainer.remove(),this.$table.removeData("resizableColumns"),this.state=2,this.unwatchOn&&this.unwatchOn(),$(window).off(".rc")},a.prototype.assignPercentageWidths=function(){var a=this;return this.$tableHeaders.each(function(b,d){var e;return e=$(d),c(e[0],100*e.innerWidth()/a.$table.outerWidth())})},a.prototype.createHandles=function(){var a,b=this;return null!=(a=this.$handleContainer)&&a.remove(),this.$table.before(this.$handleContainer=$("<div class='rc-handle-container' />")),angular.element(document).injector().invoke(function(a){var c=angular.element(b.$handleContainer).scope();c&&a(b.$handleContainer)(c)}),this.$tableHeaders.each(function(a,c){var d;if(0!==b.$tableHeaders.eq(a+1).length&&!b.$tableHeaders.eq(a).attr("data-noresize")&&!b.$tableHeaders.eq(a+1).attr("data-noresize"))return d=$("<div class='rc-handle'><div></div></div>"),d.data("th",$(c)),d.appendTo(b.$handleContainer)}),this.$handleContainer.on("mousedown touchstart",".rc-handle",this.pointerdown)},a.prototype.syncHandleWidths=function(a){var b=this;a?this.setHeaders():this.assignPercentageWidths();var c=this.$handleContainer.width(this.$table.outerWidth()).find(".rc-handle");return c.each(function(a,c){var d;return d=$(c),d.css({left:d.data("th").outerWidth()+(d.data("th").offset().left-b.$handleContainer.offset().left),height:b.options.resizeFromBody?b.$table.height():b.$table.find("thead").height()})}),b.$table.scope().$emit("ng-table-columns-widths-changed"),c},a.prototype.saveColumnWidths=function(){var a=this;if(null!=a.saveRestoreService&&this.$table.data("resizable-columns-id")){var c=this.$tableHeaders.filter(function(a,b){var c;return c=$(b),!c.attr("data-noresize")}).map(function(c,d){var e;return e=$(d),{id:a.getColumnId(e),width:b(e[0])}});return a.saveRestoreService.set(this.$table.data("resizable-columns-id"),c.get()),c}return this.$tableHeaders},a.prototype.restoreColumnWidths=function(){var a=this;if(null!=a.saveRestoreService&&this.$table.data("resizable-columns-id")){var b=a.saveRestoreService.get(this.$table.data("resizable-columns-id"));if(b&&b.length){var d=b.reduce(function(a,b){return a[b.id]=b.width,a},{});return this.$tableHeaders.each(function(b,e){var f,g;return f=$(e),(g=d[a.getColumnId(f)])?c(f[0],g):void 0})}}return this.$tableHeaders},a.prototype.totalColumnWidths=function(){var a;return a=0,this.$tableHeaders.each(function(b,c){return a+=parseFloat($(c)[0].style.width.replace("%",""))}),a},a.prototype.pointerdown=function(a){var e,f,g,h,i,j=this;return a.preventDefault(),h=d(a),e=$(a.currentTarget),f=e.data("th"),g=this.$tableHeaders.eq(this.$tableHeaders.index(f)+1),i={left:b(f[0]),right:b(g[0])},this.$table.addClass("rc-table-resizing"),this.$handleContainer.addClass("rc-table-resizing"),e.addClass("rc-handle-active"),$(document).on("mousemove.rc touchmove.rc",function(a){var b;return b=(d(a)-h)/j.$table.outerWidth()*100,c(g[0],i.right-b),c(f[0],i.left+b)}),$(document).one("mouseup touchend",function(){return $(document).off("mousemove.rc touchmove.rc"),j.$table.removeClass("rc-table-resizing"),j.$handleContainer.removeClass("rc-table-resizing"),e.removeClass("rc-handle-active"),j.syncHandleWidths(!1),j.saveColumnWidths()})},a}).directive("ngTableResizableColumnsDynamic",["$timeout","ngTableResizableColumnsHelper",function(a,b){return{restrict:"C",priority:999,require:"ngTableDynamic",link:function(c,d,e,f){function g(){i&&a.cancel(i),h.destroy(),i=a(function(){h=new b(d,c,j)})}var h,i=null,j={customReloadEvent:e.ntrcCustomReloadEvent,saveRestoreService:e.ntrcSaveRestoreService,resizeFromBody:e.ntrcResizeFromBody};c.$watch("$data",g),e.ngTableDynamic.split(" with ").forEach(function(a){c.$watch(a,g,!0)}),h=new b(d,c,j)}}}]).directive("ngTableResizableColumns",["$timeout","ngTableResizableColumnsHelper",function(a,b){return{restrict:"C",priority:999,require:"ngTable",link:function(c,d,e,f){function g(){i&&a.cancel(i),h.destroy(),i=a(function(){h=new b(d,c,j)})}var h,i=null,j={customReloadEvent:e.ntrcCustomReloadEvent,saveRestoreService:e.ntrcSaveRestoreService,resizeFromBody:e.ntrcResizeFromBody};c.$watch("$data",g),c.$watch(e.ngTable,g,!0),h=new b(d,c,j)}}}]).service("ngTableResizableColumnsSaveRestoreStoreService",function(){var a=this,b=windows.store;a.get=function(a){return b?b.get(a):null},a.set=function(a,c){b&&b.set(a,c)}});
//# sourceMappingURL=dist/ng-table-resizable-columns.min.map