/*! ngTableColumnResizable v0.1.0 by Vitalii Savchuk(esvit666@gmail.com) - https://github.com/esvit/ng-table-resizable-columns - New BSD License */

angular.module("ngTableResizableColumns",[]).factory("ngTableResizableColumnsHelper",["$compile","$timeout",function(a,b){function c(a){try{var b=a.split(":"),c=b[0],d=b[1],e=angular.element(document).injector(c);return e.get(d)}catch(f){return console.error(f),null}}function d(a,d,e){var f=function(a,b){return function(){return a.apply(b,arguments)}};this.saveRestoreService=null,e.saveRestoreService?this.saveRestoreService=c(e.saveRestoreService):window.store&&(this.saveRestoreService=angular.element(document).injector().get("ngTableResizableColumnsSaveRestoreStoreService")),this.widthCalculateService=null,e.widthCalculateService?this.widthCalculateService=c(e.widthCalculateService):this.widthCalculateService=angular.element(document).injector().get("ngTableResizableColumnsWidthCalculateService"),this.pointerdown=f(this.pointerdown,this),this.doubleClick=f(this.doubleClick,this);var g=this;this.options={customReloadEvent:e.customReloadEvent,scopeReloadEvent:e.customReloadEvent||i,rigidSizing:!1,resizeFromBody:!!e.resizeFromBody,mode:e.mode||k},this.$table=a,this.options.mode==k&&(this.$table[0].style.tableLayout="fixed"),this.state=0,this.unwatchOn=null;var h=d.$watch("params",function(a,c){if(!a.isNullInstance){if(2==g.state)return;g.setHeaders(),g.restoreColumnWidths(),g.syncHandleWidths(!0),g.state=1;var d,e=function(){d&&b.cancel(d),d=b(function(){2!=g.state&&(g.calculateColumnWidthsIfNotSaved(!0),g.syncHandleWidths(!0))},100)};g.options.customReloadEvent||$(window).on("resize.rc",e),g.unwatchOn=g.$table.scope().$on(g.options.scopeReloadEvent,e),h()}})}var e=function(a,b){var c=b&&b!=j?"px":"%";return parseFloat(a.style.width.replace(c,""))},f=function(a,b){var c=e(a,b);return isNaN(c)&&b==k&&(c=$(a).outerWidth()),c},g=function(a,b,c){var d=c&&c!=j?"px":"%";return a.style.width=""+b.toFixed(3)+d},h=function(a){return 0===a.type.indexOf("touch")?(a.originalEvent.touches[0]||a.originalEvent.changedTouches[0]).pageX:a.pageX},i="ng-table-resizable-columns-update",j="percent",k="absolute";return d.prototype.getColumnId=function(a){return this.$table.data("resizable-columns-id")+"-"+a.data("resizable-column-id")},d.prototype.setHeaders=function(){return this.$tableHeaders=this.$table.children("thead").find("tr:first th:visible"),this.assignPercentageWidths(),this.createHandles()},d.prototype.filteredHeaders=function(){return this.$tableHeaders.filter(function(a,b){return!$(b).attr("data-noresize")})},d.prototype.destroy=function(){return 2!=this.state?(1==this.state&&this.$handleContainer&&this.$handleContainer.remove(),this.$table.removeData("resizableColumns"),this.state=2,this.unwatchOn&&this.unwatchOn(),$(window).off(".rc")):void 0},d.prototype.assignPercentageWidths=function(){var a=this;return this.filteredHeaders().each(function(b,c){var d;d=$(c);var e=a.options.mode==j?100*d.outerWidth()/a.$table.outerWidth():d.outerWidth();return g(d[0],e,a.options.mode)})},d.prototype.createHandles=function(){var b,c=this;null!=(b=this.$handleContainer)&&b.remove(),this.$table.before(this.$handleContainer=$("<div class='rc-handle-container' />"));var d=angular.element(c.$handleContainer).scope();d&&a(c.$handleContainer)(d);var e=this.options.mode==j;return this.$tableHeaders.each(function(a,b){var d;if(!(e&&0===c.$tableHeaders.eq(a+1).length||c.$tableHeaders.eq(a).attr("data-noresize")||c.$tableHeaders.eq(a+1).attr("data-noresize")))return d=$("<div class='rc-handle'><div></div></div>"),d.data("th",$(b)),d.appendTo(c.$handleContainer)}),this.$handleContainer.on("dblclick",".rc-handle",this.doubleClick),this.$handleContainer.on("mousedown touchstart",".rc-handle",this.pointerdown)},d.prototype.syncHandleWidths=function(a){var b=this;a?this.setHeaders():this.options.mode==j&&this.assignPercentageWidths();var c=this.$handleContainer.width(this.$table.outerWidth()).find(".rc-handle");return c.each(function(a,c){var d;return d=$(c),d.css({left:d.data("th").outerWidth()+(d.data("th").offset().left-b.$handleContainer.offset().left),height:b.options.resizeFromBody?b.$table.height():b.$table.children("thead").height()})}),a||b.$table.scope().$emit("ng-table-columns-widths-changed"),c},d.prototype.saveColumnWidths=function(){var a=this;if(null!=a.saveRestoreService&&this.$table.data("resizable-columns-id")){var b=this.filteredHeaders().map(function(b,c){var d;return d=$(c),{id:a.getColumnId(d),width:e(d[0],a.options.mode),mode:a.options.mode}});return a.saveRestoreService.set(this.$table.data("resizable-columns-id"),b.get()),b}return this.$tableHeaders},d.prototype.restoreColumnWidths=function(){var a=this;if(null!=a.saveRestoreService&&this.$table.data("resizable-columns-id")){var b=a.saveRestoreService.get(this.$table.data("resizable-columns-id")),c={};return b&&b.length?c=b.reduce(function(b,c){var d=c.mode||j;if(d==a.options.mode)b[c.id]=c.width;else switch(a.options.mode){case j:switch(c.mode){case k:b[c.id]=100*c.width/a.$table.outerWidth()}break;case k:switch(c.mode){case j:b[c.id]=c.width*a.$table.outerWidth()/100}}return b},{}):this.options.mode==k&&(c=this.calculateColumnWidths()),this.applyColumnWidths(c)}return this.$tableHeaders},d.prototype.applyColumnWidths=function(a){var b=this;return this.filteredHeaders().each(function(c,d){var e,f;return e=$(d),(f=a[b.getColumnId(e)])?g(e[0],f,b.options.mode):void 0}),this.options.mode==k&&g(this.$table[0],this.totalColumnWidths(),this.options.mode),this.$tableHeaders},d.prototype.calculateColumnWidths=function(a){var b=this,c=this.$tableHeaders.get().reduce(function(a,c){var d=$(c),e=b.getMaxWidthFromColumn(d,2);return a[b.getColumnId(d)]=e,a},{});if(a){var d=Object.keys(c).map(function(a){return{id:a,width:c[a],mode:b.options.mode}});b.saveRestoreService.set(b.$table.data("resizable-columns-id"),d)}return c},d.prototype.calculateColumnWidthsIfNotSaved=function(a){var b=this;if(null!=b.saveRestoreService&&b.$table.data("resizable-columns-id")){var c=b.saveRestoreService.get(b.$table.data("resizable-columns-id"));if(c&&c.length)return}return b.calculateColumnWidths(a)},d.prototype.totalColumnWidths=function(){var a,b=this;return a=0,this.$tableHeaders.each(function(c,d){return a+=f(d,b.options.mode)}),a},d.prototype.updatePercentageWidths=function(a,b,c,d){return g(a[0],c.right-d),g(b[0],c.left+d)},d.prototype.updateAbsoluteWidths=function(a,b,c){return g(a[0],b.left+c,this.options.mode),g(this.$table[0],b.table+c,this.options.mode)},d.prototype.pointerdown=function(a){var b,c,d,f,g,i=this;return a.preventDefault(),f=h(a),b=$(a.currentTarget),c=b.data("th"),g={left:e(c[0],this.options.mode)},i.options.mode==j?(d=this.$tableHeaders.eq(this.$tableHeaders.index(c)+1),g.right=e(d[0],this.options.mode)):g.table=e(this.$table[0],this.options.mode),this.$table.addClass("rc-table-resizing"),this.$handleContainer.addClass("rc-table-resizing"),b.addClass("rc-handle-active"),$(document).on("mousemove.rc touchmove.rc",function(a){var b;return i.options.mode==j?(b=(h(a)-f)/i.$table.outerWidth()*100,i.updatePercentageWidths(c,d,g,b)):(b=h(a)-f,i.updateAbsoluteWidths(c,g,b))}),$(document).one("mouseup touchend",function(){return $(document).off("mousemove.rc touchmove.rc"),i.$table.removeClass("rc-table-resizing"),i.$handleContainer.removeClass("rc-table-resizing"),b.removeClass("rc-handle-active"),i.syncHandleWidths(!1),i.saveColumnWidths()})},d.prototype.doubleClick=function(a){var b,c,d,f=this;a.preventDefault(),b=$(a.currentTarget),c=b.data("th"),d={left:e(c[0],f.options.mode)},d.table=e(f.$table[0],f.options.mode);var g=f.getMaxWidthFromColumn(c);return f.updateAbsoluteWidths(c,d,g-d.left),f.syncHandleWidths(!1),f.saveColumnWidths()},d.prototype.getMaxWidthFromColumn=function(a,b){var c=this,d=a.index(),e=c.getColumnId(a).replace(/[^\w]/g,"-"),f=e+"-c",g=c.$table.children("tbody[ng-repeat]").children("tr");g.add(c.$table.children("tbody").children("tr[ng-repeat]")),b&&(g=g.slice(0,b));var h=g.children("td:nth-child("+(d+1)+")").add(a).each(function(b,d){var g=d==a[0]?e:f,h=$(d).data("resizable-columns-col-immutable"),i=null!=h?h:!0;c.widthCalculateService.recalculateWidth(d,g,i)}).map(function(a,b){return $(b).data("overflowWidth")}),i=h.get().reduce(function(a,b){return Math.max(a,b)},0);return i},d}]).directive("ngTableResizableColumnsDynamic",["$timeout","ngTableResizableColumnsHelper",function(a,b){return{restrict:"C",priority:999,require:"ngTableDynamic",link:function(c,d,e,f){function g(){i&&a.cancel(i),h&&(h.destroy(),h=null),i=a(function(){h=new b(d,c,j)})}var h,i=null,j={customReloadEvent:e.ntrcCustomReloadEvent,saveRestoreService:e.ntrcSaveRestoreService,widthCalculateService:e.ntrcWidthCalculateService,resizeFromBody:e.ntrcResizeFromBody,mode:e.ntrcMode};c.$watch("$data",g),e.ngTableDynamic.split(" with ").forEach(function(a){c.$watch(a,g,!0)}),g()}}}]).directive("ngTableResizableColumns",["$timeout","ngTableResizableColumnsHelper",function(a,b){return{restrict:"C",priority:999,require:"ngTable",link:function(c,d,e,f){function g(){i&&a.cancel(i),h&&(h.destroy(),h=null),i=a(function(){h=new b(d,c,j)})}var h,i=null,j={customReloadEvent:e.ntrcCustomReloadEvent,saveRestoreService:e.ntrcSaveRestoreService,widthCalculateService:e.ntrcWidthCalculateService,resizeFromBody:e.ntrcResizeFromBody,mode:e.ntrcMode};c.$watch("$data",g),c.$watch(e.ngTable,g,!0),g()}}}]).service("ngTableResizableColumnsSaveRestoreStoreService",function(){var a=this,b=windows.store;a.get=function(a){return b?b.get(a):null},a.set=function(a,c){b&&b.set(a,c)}}).service("ngTableResizableColumnsWidthCalculateService",function(){var a=this;a.recalculateWidth=function(a,b,c){var d=$(a);if(c){var e=d.data("resizable-columns-col-width-"+b);return e||(e=d.outerWidth(),d.data("resizable-columns-col-width-"+b,e)),e}return d.outerWidth()}});
//# sourceMappingURL=dist/ng-table-resizable-columns.min.map